<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>NEMINO - خرید و فروش بازی‌های دیجیتال</title>
  <script src="https://cdn.jsdelivr.net/npm/react@18.2.0/umd/react.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18.2.0/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7.24.0/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
  <link rel="stylesheet" href="css/styles.css">
  <!-- Firebase SDK (غیرماژولار) -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js"></script>
</head>
<body class="text-white font-sans">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect } = React;

    // تنظیم Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyCP8hIa8_TnFhgHye_RJYfz4JHZx3ox71A",
      authDomain: "nemino-crm.firebaseapp.com",
      projectId: "nemino-crm",
      storageBucket: "nemino-crm.firebasestorage.app",
      messagingSenderId: "91744780922",
      appId: "1:91744780922:web:562b757d5021caed0df1c3",
      measurementId: "G-NLNWVLCQJZ"
    };
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    const products = [
      { id: 1, name: "پک الماس فری فایر", price: "499,000 تومان", image: "https://via.placeholder.com/200x200?text=FreeFire" },
      { id: 2, name: "اکانت پابجی لِوِل 50", price: "1,200,000 تومان", image: "https://via.placeholder.com/200x200?text=PUBG" },
      { id: 3, name: "اسکین لجندری کالاف دیوتی", price: "799,000 تومان", image: "https://via.placeholder.com/200x200?text=COD" },
      { id: 4, name: "گیفت کارت استیم 50$", price: "1,500,000 تومان", image: "https://via.placeholder.com/200x200?text=Steam" },
    ];

    function App() {
      const [isAuthenticated, setIsAuthenticated] = useState(false);
      const [showLogin, setShowLogin] = useState(true);
      const [username, setUsername] = useState("");
      const [email, setEmail] = useState("");
      const [phone, setPhone] = useState("");
      const [password, setPassword] = useState("");
      const [showPassword, setShowPassword] = useState(false);
      const [isSignup, setIsSignup] = useState(false);
      const [verificationCode, setVerificationCode] = useState("");
      const [inputCode, setInputCode] = useState("");
      const [showVerification, setShowVerification] = useState(false);
      const [showDashboard, setShowDashboard] = useState(false);
      const [notification, setNotification] = useState("");

      useEffect(() => {
        // چک کردن وضعیت لاگین کاربر
        auth.onAuthStateChanged((user) => {
          if (user) {
            setIsAuthenticated(true);
            db.collection('users').doc(user.uid).get().then((doc) => {
              if (doc.exists) {
                setUsername(doc.data().username);
              }
            });
          } else {
            setIsAuthenticated(false);
            setUsername("");
          }
        });
      }, []);

      const isUsernameValid = username.length > 4;
      const isEmailValid = email.includes("@") && email.includes(".");
      const isPhoneValid = phone.length >= 10 && /^\d+$/.test(phone) && phone.startsWith("9");
      const isPasswordValid = isSignup ? /^[A-Z]/.test(password) && /\d/.test(password) && password.length >= 8 : true;

      const getPasswordStrength = () => {
        if (!password || !isSignup) return { strength: "", color: "", width: "" };
        if (isPasswordValid) return { strength: "قوی", color: "bg-green-500", width: "w-full" };
        if (password.length >= 8) return { strength: "متوسط", color: "bg-yellow-500", width: "w-2/3" };
        return { strength: "ضعیف", color: "bg-red-500", width: "w-1/3" };
      };
      const passwordStrength = getPasswordStrength();

      const isFormValid = isSignup ? isUsernameValid && isEmailValid && isPhoneValid && isPasswordValid : isEmailValid;

      const generateCode = () => {
        return Math.floor(100000 + Math.random() * 900000).toString();
      };

      const handleLogin = async (e) => {
        e.preventDefault();
        try {
          await auth.signInWithEmailAndPassword(email, password);
          setShowLogin(false);
          setShowDashboard(false);
          setNotification("ورود با موفقیت انجام شد!");
        } catch (error) {
          setNotification("خطا در ورود: ایمیل یا رمز اشتباهه!");
        }
        setTimeout(() => setNotification(""), 4000);
      };

      const handleSignup = async (e) => {
        e.preventDefault();
        if (isFormValid) {
          try {
            const userCredential = await auth.createUserWithEmailAndPassword(email, password);
            await db.collection('users').doc(userCredential.user.uid).set({
              username,
              email,
              phone: `+98${phone}`,
              createdAt: firebase.firestore.FieldValue.serverTimestamp()
            });
            const code = generateCode();
            setVerificationCode(code);
            setShowVerification(true);
            setNotification("ثبت‌نام موفق! کد تأیید رو وارد کن.");
            // TODO: بعداً اینجا SMS واقعی با کاوه‌نگار ارسال می‌شه
            console.log(`کد تأیید: ${code} به شماره +98${phone}`);
          } catch (error) {
            setNotification("خطا در ثبت‌نام: " + error.message);
          }
        } else {
          setNotification("لطفاً همه فیلدها رو درست پر کن!");
        }
        setTimeout(() => setNotification(""), 4000);
      };

      const handleVerify = (e) => {
        e.preventDefault();
        if (inputCode === verificationCode) {
          setShowVerification(false);
          setShowLogin(false);
          setShowDashboard(false);
          setNotification(`خوش اومدی، ${username}!`);
        } else {
          setNotification("کد تأیید اشتباهه!");
        }
        setTimeout(() => setNotification(""), 4000);
      };

      const closeLogin = () => {
        setShowLogin(false);
        setNotification(`خوش اومدی، ${username}!`);
        setTimeout(() => setNotification(""), 4000);
      };

      const handleAccountClick = (e) => {
        e.preventDefault();
        if (isAuthenticated) {
          setShowDashboard(true);
          setShowLogin(false);
        } else {
          setShowLogin(true);
          setShowDashboard(false);
        }
      };

      return (
        <div>
          {notification && (
            <div className="notification">
              {notification}
            </div>
          )}

          {(showLogin || showDashboard) && (
            <div
              className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"
              style={{
                backgroundImage: "url('https://i.imgur.com/sD2WbZM.webp')",
                backgroundSize: "cover",
                backgroundPosition: "center",
                minHeight: "100vh",
              }}
            >
              {showDashboard ? (
                <div className="bg-gray-800 p-8 rounded-lg shadow-lg w-full max-w-md relative">
                  <button
                    onClick={() => setShowDashboard(false)}
                    className="absolute top-2 left-2 text-gray-400 hover:text-white"
                  >
                    <i className="fas fa-times"></i>
                  </button>
                  <h2 className="text-2xl font-bold mb-6 text-center">پنل کاربری {username}</h2>
                  <div className="text-center">
                    <p className="mb-4">خوش اومدی، {username}!</p>
                    <p className="mb-4">اینجا می‌تونی اطلاعات حساب، خریدها و تنظیماتت رو مدیریت کنی.</p>
                    <button
                      onClick={async () => {
                        await auth.signOut();
                        setShowDashboard(false);
                        setShowLogin(true);
                        setNotification("با موفقیت خارج شدی!");
                        setTimeout(() => setNotification(""), 4000);
                      }}
                      className="w-full bg-red-600 hover:bg-red-700 text-white py-2 rounded transition duration-300"
                    >
                      خروج از حساب
                    </button>
                  </div>
                </div>
              ) : (
                <div className="bg-gray-800 p-8 rounded-lg shadow-lg w-full max-w-md relative">
                  <button
                    onClick={closeLogin}
                    className="absolute top-2 left-2 text-gray-400 hover:text-white"
                  >
                    <i className="fas fa-times"></i>
                  </button>
                  {showVerification ? (
                    <>
                      <h2 className="text-2xl font-bold mb-6 text-center">تأیید کد</h2>
                      <form onSubmit={handleVerify}>
                        <div className="mb-6">
                          <label className="block text-sm mb-2">کد تأیید</label>
                          <input
                            type="text"
                            value={inputCode}
                            onChange={(e) => setInputCode(e.target.value)}
                            className="w-full p-2 bg-gray-700 rounded text-white focus:outline-none focus:ring-2 focus:ring-purple-500"
                            placeholder="کد ۶ رقمی رو وارد کن"
                          />
                          <p className="text-xs text-gray-400 mt-1">مثال: 123456</p>
                        </div>
                        <button
                          type="submit"
                          className="w-full bg-purple-600 hover:bg-purple-700 text-white py-2 rounded transition duration-300"
                        >
                          تأیید
                        </button>
                      </form>
                    </>
                  ) : (
                    <>
                      <h2 className="text-2xl font-bold mb-6 text-center">
                        {isSignup ? "ساخت حساب کاربری" : "ورود به نمینو"}
                      </h2>
                      <form onSubmit={isSignup ? handleSignup : handleLogin}>
                        {isSignup && (
                          <div className="mb-4">
                            <label className="block text-sm mb-2">نام کاربری</label>
                            <input
                              type="text"
                              value={username}
                              onChange={(e) => setUsername(e.target.value)}
                              className={`w-full p-2 bg-gray-700 rounded text-white focus:outline-none focus:ring-2 ${
                                isUsernameValid ? "focus:ring-green-500" : "focus:ring-red-500"
                              }`}
                              placeholder="نام کاربری خودت رو وارد کن"
                            />
                            <p className="text-xs text-gray-400 mt-1">مثال: ali_gamer123</p>
                            {!isUsernameValid && username && (
                              <p className="text-xs text-red-500 mt-1">باید بیشتر از ۴ حرف باشه</p>
                            )}
                          </div>
                        )}
                        <div className="mb-4">
                          <label className="block text-sm mb-2">ایمیل</label>
                          <input
                            type="email"
                            value={email}
                            onChange={(e) => setEmail(e.target.value)}
                            className={`w-full p-2 bg-gray-700 rounded text-white focus:outline-none focus:ring-2 ${
                              isEmailValid ? "focus:ring-green-500" : "focus:ring-red-500"
                            }`}
                            placeholder="ایمیل خودت رو وارد کن"
                          />
                          <p className="text-xs text-gray-400 mt-1">مثال: ali@example.com</p>
                          {!isEmailValid && email && (
                            <p className="text-xs text-red-500 mt-1">ایمیل معتبر وارد کن</p>
                          )}
                        </div>
                        {isSignup && (
                          <div className="mb-4">
                            <label className="block text-sm mb-2">شماره تلفن</label>
                            <div className="phone-input-container">
                              <span className="inline-flex items-center px-3 h-10 bg-gray-700 text-white border-r border-gray-500">
                                <img
                                  src="https://flagcdn.com/16x12/ir.png"
                                  alt="پرچم ایران"
                                  className="ml-2"
                                />
                                +98
                              </span>
                              <input
                                type="tel"
                                value={phone}
                                onChange={(e) => {
                                  const value = e.target.value;
                                  if (value === "" || /^\d*$/.test(value)) {
                                    setPhone(value);
                                  }
                                }}
                                className={`p-2 h-10 text-white focus:outline-none focus:ring-2 ${
                                  isPhoneValid ? "focus:ring-green-500" : "focus:ring-red-500"
                                }`}
                                placeholder="912 123 1234"
                              />
                            </div>
                            {!isPhoneValid && phone && (
                              <p className="text-xs text-red-500 mt-1">حداقل ۱۰ رقم</p>
                            )}
                          </div>
                        )}
                        <div className="mb-6 relative">
                          <label className="block text-sm mb-2">رمز عبور</label>
                          <input
                            type={showPassword ? "text" : "password"}
                            value={password}
                            onChange={(e) => setPassword(e.target.value)}
                            className={`w-full p-2 bg-gray-700 rounded text-white focus:outline-none focus:ring-2 ${
                              isPasswordValid ? "focus:ring-green-500" : "focus:ring-red-500"
                            }`}
                            placeholder="رمز عبور خودت رو وارد کن"
                          />
                          <button
                            type="button"
                            onClick={() => setShowPassword(!showPassword)}
                            className="absolute left-2 top-9 text-gray-400 hover:text-white"
                          >
                            <i className={showPassword ? "fas fa-eye-slash" : "fas fa-eye"}></i>
                          </button>
                          <p className="text-xs text-gray-400 mt-1">مثال: Password123</p>
                          {isSignup && !isPasswordValid && password && (
                            <p className="text-xs text-red-500 mt-1">اولین حرف بزرگ و حداقل یک عدد (۸+ حرف)</p>
                          )}
                          {isSignup && (
                            <div className="mt-2">
                              <div className="bg-gray-600 h-2 rounded">
                                <div
                                  className={`${passwordStrength.color} ${passwordStrength.width} h-2 rounded transition-all`}
                                ></div>
                              </div>
                              <p className="text-xs text-gray-400 mt-1">قدرت رمز: {passwordStrength.strength}</p>
                            </div>
                          )}
                        </div>
                        <button
                          type="submit"
                          disabled={isSignup && !isFormValid}
                          className={`w-full py-2 rounded text-white transition duration-300 ${
                            isSignup && !isFormValid
                              ? "bg-gray-600 cursor-not-allowed"
                              : "bg-purple-600 hover:bg-purple-700"
                          }`}
                        >
                          {isSignup ? "ثبت‌نام" : "ورود"}
                        </button>
                      </form>
                      <p className="mt-4 text-center text-sm">
                        {isSignup ? "حساب داری؟" : "حساب نداری؟"}
                        <button
                          onClick={() => setIsSignup(!isSignup)}
                          className="text-purple-400 hover:underline mr-1"
                        >
                          {isSignup ? "وارد شو" : "ثبت‌نام کن"}
                        </button>
                      </p>
                    </>
                  )}
                </div>
              )}
            </div>
          )}

          <div className={(showLogin || showDashboard) ? "filter blur-sm" : ""}>
            <nav className="bg-gray-800 p-4 shadow-lg fixed w-full top-0 z-40">
              <div className="container mx-auto flex justify-between items-center">
                <div className="flex items-center space-x-2">
                  <img
                    src="https://i.imgur.com/n5MJnc5.webp"
                    alt="NEMINO"
                    className="h-12 w-auto"
                  />
                  <div className="text-2xl font-bold text-purple-400">NEMINO</div>
                </div>
                <div className="flex space-x-4">
                  <a href="#" className="text-white hover:text-purple-400 transition">
                    <i className="fas fa-home ml-1"></i> خانه
                  </a>
                  <a href="#" className="text-white hover:text-purple-400 transition">
                    <i className="fas fa-gamepad ml-1"></i> محصولات
                  </a>
                  <a
                    href="#"
                    onClick={handleAccountClick}
                    className="text-white hover:text-purple-400 transition"
                  >
                    <i className="fas fa-user ml-1"></i>
                    {isAuthenticated ? `پنل کاربری (${username})` : "حساب کاربری"}
                  </a>
                  <a href="#" className="text-white hover:text-purple-400 transition">
                    <i className="fas fa-shopping-cart ml-1"></i> سبد خرید
                  </a>
                </div>
              </div>
            </nav>

            <div className="pt-20">
              <div className="relative h-96 bg-cover bg-center">
                <a href="#">
                  <img
                    src="https://i.imgur.com/n5MJnc5.webp"
                    alt="نمینو"
                    className="w-full h-full object-cover"
                  />
                </a>
              </div>

              <div className="container mx-auto py-12">
                <h2 className="text-3xl font-bold mb-8 text-center">محصولات ویژه</h2>
                <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
                  {products.map((product) => (
                    <div
                      key={product.id}
                      className="bg-gray-800 rounded-lg shadow-lg overflow-hidden transform hover:scale-105 transition duration-300"
                    >
                      <img src={product.image} alt={product.name} className="w-full h-48 object-cover" />
                      <div className="p-4">
                        <h3 className="text-xl font-semibold mb-2">{product.name}</h3>
                        <p className="text-purple-400 mb-4">{product.price}</p>
                        <button className="w-full bg-purple-600 hover:bg-purple-700 text-white py-2 rounded transition duration-300">
                          افزودن به سبد خرید
                        </button>
                      </div>
                    </div>
                  ))}
                </div>
              </div>

              <footer className="bg-gray-800 py-8">
                <div className="container mx-auto text-center">
                  <p className="text-sm">© 1404 نمینو - همه حقوق محفوظه.</p>
                  <div className="flex justify-center space-x-4 mt-4">
                    <a href="#" className="text-white hover:text-purple-400"><i className="fab fa-instagram"></i></a>
                    <a href="#" className="text-white hover:text-purple-400"><i className="fab fa-telegram"></i></a>
                    <a href="#" className="text-white hover:text-purple-400"><i className="fab fa-twitter"></i></a>
                  </div>
                </div>
              </footer>
            </div>
          </div>
        </div>
      );
    }

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>
</html>
